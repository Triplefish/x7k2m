name: 基金估值追踪

on:
  schedule:
    # 每10分钟运行一次
    # 注意：GitHub Actions 最少间隔是5分钟（付费版可设置）
    - cron: '*/10 * * * *'
  
  workflow_dispatch:  # 允许手动触发

jobs:
  update-fund-tracker:
    runs-on: ubuntu-latest
    
    steps:
    - name: 检出代码
      uses: actions/checkout@v3
    
    - name: 设置 Python 环境
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip'
    
    - name: 安装依赖
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: 运行基金估值追踪
      env:
        VIKA_API_TOKEN: ${{ secrets.VIKA_API_TOKEN }}
        VIKA_DATASHEET_ID: ${{ secrets.VIKA_DATASHEET_ID }}
      run: |
        echo "调试：检查环境变量..."
        if [ -z "$VIKA_API_TOKEN" ]; then echo "❌ VIKA_API_TOKEN 未设置"; else echo "✅ VIKA_API_TOKEN 已设置"; fi
        if [ -z "$VIKA_DATASHEET_ID" ]; then echo "❌ VIKA_DATASHEET_ID 未设置"; else echo "✅ VIKA_DATASHEET_ID 已设置"; fi
        echo ""
        python fund_tracker.py
    
    - name: 显示完成信息
      if: success()
      run: |
        echo "✅ 基金估值更新成功！"
        echo "⏰ 更新时间: $(date '+%Y-%m-%d %H:%M:%S')"
