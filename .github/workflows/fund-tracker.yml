name: 基金估值追踪

on:
  schedule:
    # 交易日每小时运行一次 (周一到周五 9:30-15:00)
    # 北京时间 = UTC+8，所以 1:30-7:00 UTC
    - cron: '30 1-7 * * 1-5'
  
  workflow_dispatch:  # 允许手动触发

jobs:
  update-fund-tracker:
    runs-on: ubuntu-latest
    
    steps:
    - name: 检出代码
      uses: actions/checkout@v3
    
    - name: 设置 Python 环境
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip'
    
    - name: 安装依赖
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: 运行基金估值追踪
      env:
        VIKA_API_TOKEN: ${{ secrets.VIKA_API_TOKEN }}
        VIKA_DATASHEET_ID: ${{ secrets.VIKA_DATASHEET_ID }}
      run: |
        python fund_tracker.py
    
    - name: 显示完成信息
      if: success()
      run: |
        echo "✅ 基金估值更新成功！"
        echo "⏰ 更新时间: $(date '+%Y-%m-%d %H:%M:%S')"
